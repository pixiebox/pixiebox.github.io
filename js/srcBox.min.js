;(function(m,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a:m.srcBox=a(m)})(this,function(m){var a={mergedElements:[],selector:"",devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},lazyElems:[],breakpoint:0,currentBreakpoint:0,breakpointVal:0,viewPortWidth:0,forEach:function(b,a,c){if("[object Object]"===Object.prototype.toString.call(b))for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&a.call(c,b[d],d,b);
else{d=0;for(var f=b.length;d<f;d++)a.call(c,b[d],d,b)}},extend:function(b,e){var c={};a.forEach(b,function(a,e){c[e]=b[e]});a.forEach(e,function(b,a){c[a]=e[a]});return c},getViewportWidthInCssPixels:function(){for(var b=Math,a=[window.innerWidth,window.document.documentElement.clientWidth,window.document.documentElement.offsetWidth,window.document.body.clientWidth],c=0,d,f=window.screen.width;c<a.length;c++)isNaN(a[c])&&(a.splice(c,1),c--);a.length&&(d=b.max.apply(b,a),isNaN(f)||(d=b.min(f,d)));
return d||f||0},getBreakpoint:function(b,e){for(var c=e,d=0,f={},g,h,l,k;g=b[d];){k=g.minWidth;h=g.maxWidth;l="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;if(0<e){if(k&&h&&e>=k&&e<=h||k&&!h&&e>=k||h&&!k&&e<=h)if(!l||l&&a.devicePixelRatio()>=l)f=g}else if(0>=c||k<c||h<c)c=k||h||c,f=g;d++}return f},setBreakpoint:function(b,e){var c=b.getAttribute("data-breakpoint"),d=b.getAttribute("data-img");if(!c||!d)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');
c=c.replace("{folder}",e)+b.getAttribute("data-img");/(^|\s)lag(\s|$)/.test(b.className)?(b.setAttribute("data-lag-src",c),a.lazyElems.push(b)):(b.src=c,b.removeAttribute("height"))},addEvent:function(b,a,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a[b]=c},removeEvent:function(a,e,c){e.removeEventListener?e.removeEventListener(a,c,!1):e.detachEvent?e.detachEvent("on"+a,c):e.splice(a,1)},removeClass:function(a,e){var c="",d,f=a.className.split(" ");for(d=
0;d<f.length;d++)f[d]!==e&&(c+=f[d]+" ");a.className=c},scrollPos:function(){return[void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft]},offset:function(a,e){a=a.getBoundingClientRect();switch(e){case "left":return a.left;case "top":return a.top;default:return 0}},belowthefold:function(b){return(window.innerHeight?
window.innerHeight:Math.max(document.documentElement.clientHeight,document.body.clientHeight))+a.scrollPos()[0]<=a.offset(b,"top")},rightoffold:function(b){return(window.innerWidth?window.innerWidth:Math.max(document.documentElement.clientWidth,document.body.clientWidth))+a.scrollPos()[1]<=a.offset(b,"left")},abovethetop:function(b){return a.scrollPos()[0]>=a.offset(b,"top")+b.height},leftofbegin:function(b){return a.scrollPos()[1]>=a.offset(b,"left")+b.width},inviewport:function(b){return!a.rightoffold(b)&&
!a.leftofbegin(b)&&!a.belowthefold(b)&&!a.abovethetop(b)},setLazySrc:function(){for(var b=a.lazyElems.length;b--;)a.inviewport(a.lazyElems[b])&&(a.lazyElems[b].src=a.lazyElems[b].getAttribute("data-lag-src"),a.lazyElems[b].removeAttribute("height"),a.lazyElems.splice(b,1));a.lazyElems.length||a.removeEvent("scroll",window,a.setLazySrc)},debounce:function(a,e,c){var d;return function(){var f=this,g=arguments,h=c&&!d;clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(f,g)},e);h&&a.apply(f,g)}},
setImage:function(b,e){if("IMG"===b.nodeName){var c=a.getBreakpoint(e.breakpoints,b.parentNode.offsetWidth);a.setBreakpoint(b,"minDevicePixelRatio"in c?c.maxWidth:c.folder)}},setImages:function(b,e){viewPortWidth=a.getViewportWidthInCssPixels();breakpoint=a.getBreakpoint(e.breakpoints,viewPortWidth);breakpointVal="minDevicePixelRatio"in breakpoint?breakpoint.maxWidth:breakpoint.folder;a.currentBreakpoint!=breakpointVal&&(a.currentBreakpoint=breakpointVal,a.forEach(b,function(c,d){a.setImage(b[d],
e)}),a.addEvent("scroll",window,a.setLazySrc))},supportsOrientationChange:function(){return"ontouchstart"in window},orientationEvent:function(){return supportsOrientationChange?"orientationchange":"resize"}},n={init:function(b,e){if(document.all&&!document.addEventListener){var c=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return c.apply(this,arguments);for(var a=[],b=2<=arguments.length?arguments[1]:this.length,d=1<=arguments.length?arguments[0]:0;d<b;d++)a.push(this[d]);
return a}}var d=Array.prototype.slice.call(document.querySelectorAll(b)),f={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",minWidth:748,maxWidth:1024,minDevicePixelRatio:2}]},
g="object"===typeof e&&"breakpoints"in e?"extend"in e&&!0===e.extend?a.extend(f,e):e:a.extend(f,e),h,l=function(){h--;if(!h)g.onComplete()};a.selector=b;a.mergedElements=a.mergedElements.concat(d);a.setImages(d,g);a.setLazySrc();a.addEvent("scroll",window,a.setLazySrc);a.addEvent(a.orientationEvent,window,a.debounce(function(){a.setImages(a.mergedElements,g)},250));"onComplete"in g&&(h=d.length)&&a.forEach(d,function(b,c){a.setImage(d[c],g);if(/[ws]*(lag)+[ws]*/.test(d[c].className)){if(h--,!h)g.onComplete()}else if(d[c].onload=
l,"complete"==d[c].readyState)d[c].onload();else if(d[c].readyState)d[c].src=d[c].src;else if(d[c].complete)d[c].onload();else if(void 0===d[c].complete){var e=d[c].src;d[c].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";d[c].src=e}})},reset:function(b){a.currentBreakpoint=0;var e=a.mergedElements;a.forEach(a.mergedElements,function(b,d){a.removeClass(a.mergedElements[d],a.selector.substring(1))});n.init(a.selector,b);a.forEach(e,function(b,d){e[d].className+=a.selector.substring(1)})}};
return n});